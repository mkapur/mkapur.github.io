---
title: "M.S. Kapur General Exam"
author: "Committee: Haltuch, Branch, Essington"
date: "02 Jun 2020 12-3pm, via Zoom"
subtitle: "Chair: André Punt | GSR: Jon Wakefield"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [solarized-dark.css]
    nature:
      ratio: "16:11.25"
      beforeInit: "https://platform.twitter.com/widgets.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
```{r setup, include=FALSE}
library(icon)
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE,
                      comment = NA, rows.print = 16)
```
<!-- layout: true -->
<!-- .header[`r icon::fa('github')` @mkapur] -->

---
# Dissertation Goals
.large[
+ Provide needed science evaluating alternative
spatial management strategies for stock assessment <Br>

Working Title:

.inverse[Implications of Spatial Mis-specification in
Management Strategy Evaluation for North
Pacific Sablefish]]
---
# .inverse[ Motivation I: Sablefish]
---
background-image: url("nepmap.jpg")
background-position: center
background-size: contain
<br><Br><br><Br>
---
background-image: url("regional_biomass.png")
background-position: center
background-size: contain
<br><Br><br>

???
group came together in 2018
this couples with some anecdotes (recruitment) led us to examine
where there may be a mismatch in the actual demography of sab, and our managemetn framework
and more importantly what effects those choices have on resultant management estimates
---
# Research Questions

## Sablefish Specific

+ What is the current spatial structure of sablefish demography (namely growth) across the NE Pacific?

--

+ Can a spatially-explicit, range-wide operating model produce similar population dynamics as suggested by the current regional assessments? 

--

+ If not, how distinct are the dynamics produced by such an operating model? 
---
#.inverse[ Motiviation II: Science]
---

.pull-left[
+ A fair bit has been done on spatial mis-match vs. estimation uncertainty.

+ Less work on how spatial misspecification flows into HCR performance
]


.pull-right[
![](Puntetal2015b_fulldat.png)
]

???

this figure is from one of andre's papers which was a simulation study looking at various degrees
of a sptl assessment model. the study was pretty involved, but here he is showing rel err of tot bio
across various setups. what is worth pointing out is these two; ths bzsa is a fairly simple spatial 
assessment (by zone) with only add'l catchability
and the full matches the OM completely. as we might expect, the full model is the least biased;
but these add'l spatial models are actually both biased and imprecise;
the takeaway from this paper is perhaps intermediate approaches might be best.

will show slide later with actual questions but whant to acknolwege
that this is using sab as case study and aims to encompass tradeoffs between 
spatial strucutre at both the operational and estimation levels, as well as evaluate performance of various
alternative HCRs


---
# Research Questions

## Broader

+ What happens to estimated quantities when spatial structure diverges from reality?

--

+ Are there combinations of HCRs/Spatial assessment frameworks which *reduce undesirable outcomes for the sablefish fishery or population*?

---
# Quick overview: Chapters & Status
+ CH1: Spatial Variation in sablefish growth **(published)**
+ CH2: An Operating Model for NE Pacific Sablefish **(document ~finalized)**
+ CH3: A Management Strategy Evaluation for NE Pacific Sablefish 
+ CH4: Sneaking up on a well-specified model **(internal review)**

---
.header[`r icon::fa('github')` @mkapur/sab-growth]
# Chapter 1: Spatial Growth Variation
+ Genetic & tagging work says the stock is well mixed
.pull-left[![](jasono.PNG) .small[Jasonowicsz et al. 2017] ]
.pull-right[![](hansel.PNG) .small[Hanselman et al. 2015]]
 
--

+ Simple question, not-so-easy to answer

---
.header[`r icon::fa('github')` @mkapur/sab-growth]
## Chapter 1: Spatial Growth Variation
### A method to detect spatio-(temporal) breakpoints

+ “Let the data talk”

+ Fit a Generalized Additive Model (GAM) to a single age and sex

+ Smoothers for year, latitude, and longitude

+ Evaluate 1st derivative of each smoother to see where it is changing most
---
background-image: url("Screenshot (38).png")
background-position: center
background-size: contain
.header[`r icon::fa('github')` @mkapur/sab-growth]

---
background-image: url("Screenshot (39).png")
background-position: center
background-size: contain
.header[`r icon::fa('github')` @mkapur/sab-growth]

---
background-image: url("Screenshot (40).png")
background-position: center
background-size: contain
.header[`r icon::fa('github')` @mkapur/sab-growth]

---
background-image: url("BLACK_sab_smooth_map_4F.png")
background-position: center
background-size: contain
.header[`r icon::fa('github')` @mkapur/sab-growth]

???
transpose me onto a map
---
background-image: url("demog_dark.jpg")
background-position: center
background-size: cover
.header[`r icon::fa('github')` @mkapur/sab-growth]
---
.header[`r icon::fa('github')` @mkapur/sab-growth]
## Chapter 1: Spatial Growth Variation

<br><br>
.center2[
```{r, echo = FALSE,  out.width="50%", fig.show="hold"}
knitr::include_graphics(c("demog_dark.jpg","BLACK_Figure5_no130.png"))
```
]
---
.header[`r icon::fa('github')` @mkapur/sab-growth]
## Chapter 1: Spatial Growth Variation
```{r, echo = FALSE, out.width="50%", fig.show="hold"}
knitr::include_graphics(c("demog_dark.jpg","OMGrowthCurves_BLACK_2020-05-11.PNG"))
```
---
.header[`r icon::fa('github')` @mkapur/sab-growth]
## Chapter 1: Spatial Growth Variation
## Status: Published
![](ch1pub.png)



---
## Chapter 2: An Operating Model for NE Pacific Sablefish

--

+ How is the model structured?
+ What are the key assumptions?
---
background-image: url("demog_dark.jpg")
background-position: center
background-size: cover
.header[`r icon::fa('github')` @mkapur/sab-mse]

---
background-image: url("demog_dark2.jpg")
background-position: center
background-size: cover
.header[`r icon::fa('github')` @mkapur/sab-mse]
---
background-image: url("map-regions_50n_full_dark.png")
background-position: center
background-size: cover
.header[`r icon::fa('github')` @mkapur/sab-mse]
---
background-image: url("demog_dark3.jpg")
background-position: top
background-size: contain
.header[`r icon::fa('github')` @mkapur/sab-mse]

.center2[
.inverse[What Happens where?]<br>
.inverse[Management Regions (EEZ)] <Br>
Alaska (AK), British Columbia (BC), Cal. Current (CC)
  + Contain fleets
  + Accrue catches
  + Set ABCs (future)
]


---
background-image: url("demog_dark2.jpg")
background-position: center
background-size: contain
.header[`r icon::fa('github')` @mkapur/sab-mse]


.center2[
.inverse[What Happens where?]<br>
.inverse[Stocks]
+ Share params for growth, maturity, density-dependence
+ SRR operates @ stock and is partitioned

]
---
background-image: url("map-regions_50n_full_dark.png")
background-position: center
background-size: contain
.header[`r icon::fa('github')` @mkapur/sab-mse]
<Br><Br><Br><br><Br><Br><Br>
.center2[
.inverse[What Happens where?]<br>
.inverse[Sub-areas]
+ Smallest unit in OM; monitor numbers-at-age
]
---
.header[`r icon::fa('github')` @mkapur/sab-mse]
## Important OM Equations
### .small[Numbers at Age]
.small[
$N_{y+1,\gamma,a}^i=\left\{\begin{matrix}0.5R_{y+1}^i & \text{if}\ a = 0 \newline \sum_{i\neq j}\left[\left(1-\textbf{X}_a^{i,j}\right)\left.\ {N_{y,\gamma,a-1}^ie}^{-Z_{y,\gamma,a-1}^i}\right.+\textbf{X}_a^{j,i}{N_{y,\gamma,a-1}^je}^{-Z_{y,\gamma,a-1}^i}\right] & \text{if}\ 1 \leq a <A\\\sum_{i\neq j}{\left[\left(1-\textbf{X}_a^{i,j}\right)(\left.{N_{y,\gamma,A-1}^ie}^{-Z_{y,\gamma,A-1}^i}\right.\left.+{N_{y,\gamma,A-1}^ie}^{-Z_{y,\gamma,A-1}^i}\right.)\right.\ } & \text{if}\ a = A \\\ldots+\left.\textbf{X}_a^{j,i}\left({N_{y,\gamma,A}^je}^{-Z_{y,\gamma,A}^j}+{N_{y,\gamma,A-1}^je}^{-Z_{y,\gamma,A-1}^j}\right)\right]\\\end{matrix}\right.$
+ Yearly timestep
+ Monitored by sub-area $i$
+ Movement defined by $\textbf{X}^{i,j}_a$
]


---
.header[`r icon::fa('github')` @mkapur/sab-mse]
# Important OM Equations
## Reproduction I
$R_y^k=\frac{4h^kR_0^kS_y^k}{S_0^k\left(1-h^k\right)+S_y^k(5h^k-1)}e^{-0.5\sigma_R^2+{\widetilde{R}}_y^k}$ 

$S_y^k=\sum_{a}{\phi_{ik}N_{y,\gamma=female,a}^iw_{y,\gamma=female,a}^kE_a^k}$ 

+ Spatialpatial Bev-Holt at stock level $k$
+ SSB in $k$ is summation over $i$ in $k$ (invoke the magic of $\phi_{ik}$)

---
.header[`r icon::fa('github')` @mkapur/sab-mse]
# Important OM Equations
## Reproduction II
.large[
$R_y^i=\tau_{ik}R_y^k$ 
]

+ Recruitment happens at stock $k$ and is partitioned into sub-area $i$
+ $\tau_{ik}$ user-defined, by geographic area

---
.header[`r icon::fa('github')` @mkapur/sab-mse]
# Important OM Equations
# Retained Catches
$C_y^{m,f}=\sum_{i\epsilon m}\sum_{\gamma}{\sum_{a}{\phi_{if}w}_{\gamma,a}^f\frac{s_{\gamma,a}^fF_y^f\mathrm{\Omega}_{y,\gamma,a}^f}{Z_{y,\gamma,a}^i}N_{y,\gamma,a}^i(1-e^{-Z_{y,\gamma,a}^i})}$

+ Tune $F$ via hybrid method
+ $\Omega$ is retention function
+ $\phi_{if}$ matches sub-areas to fleets

---
## Chapter 2: Operating Model
## Status: Document written; code in development

---
## Chapter 3: Management Strategy Evaluation
What do we need for an MSE? <br>

--

.inverse[What do we want to test?]

---
## Chapter 3: Management Strategy Evaluation
### What do we want to test?
+ What happens to estimated quantities when spatial structure diverges from reality?
+ Are there combinations of HCRs/Spatial assessment frameworks which *reduce undesirable outcomes for the sablefish fishery or population*?



???
A suite of EMs which capture the uncertainty we are most interested in,
and performance metrics to measure output

---
background-image: url("mse1.png")
background-position: center
background-size: cover
.header[`r icon::fa('github')` @mkapur/sab-mse]
---
background-image: url("mse2.png")
background-position: center
background-size: cover
.header[`r icon::fa('github')` @mkapur/sab-mse]
---
background-image: url("mse3.png")
background-position: center
background-size: cover
.header[`r icon::fa('github')` @mkapur/sab-mse]

---
# What I expect to find out:
+ Is the current sab management paradigm performing worse than transboundary management could?
+ Are there key processes that dictate that answer?
+ Another nail in the space-rules coffin
---
## Chapter 3: Management Strategy Evaluation
## Status: Teams assembled for EM, HCR & Performance Metrics

---
## Chapter 4: Sneaking up on a well-specified model

## Mis-specification: What Happens?

.pull-left[
+ Estimates are biased/imprecise
]

.pull-right[
![](ikea.jpg)]


---

# Research Questions

+ Do we need to fix every mis-spec before the model performs “well”? 

+ Are certain mis-specifications more or less influential on model bias? 

???
- guiding questions: quantity and identity
- second is like asking are putting the legs on right more important than the back?

---
background-image: url("pars1.png")
background-position: center
background-size: contain

???
- for this group, generally process, misspec straightfwd, fix at wrong value

---
background-image: url("method10.png")
background-position: center
background-size: contain
???
- how this looks for real
- OM is just this little white box
- stack of 6 green boxes each em, numbers mean misspecs
- the sixths totally corrected

---
# .inverse[Results]
.pull-center[
![](ikea2.jpg)
]


???
- I will walk through the hilites of results, 
- as you can imagine there is a lot to wade thru with 14,000 model outputs

---
background-image: url("SSB_error_panel_E1_dark.png")
background-position: center
background-size: contain
???
- these are from E1. 
- we are seeing what we would expec
- as misspecs go down so does rel err, with the most correct model being
the most correct
---
background-image: url("SSB_Terminal_Tile_E1.png")
background-position: top
background-size: contain
<Br><Br><br><br><Br><Br><Br><Br><br>
<Br><Br><br><br><Br><Br><br><br><br>
```{r echo = FALSE, fig.align = 'left', out.height="10%", out.width="25%",fig.retina = 2}
knitr::include_graphics("legend2.png")
```

???
- the more interesting question is: what is the identity of those misspecs that give us the most bang for our buck?
- this plot is averaged across OMs etc and shows the abs relative error... etc
- the x axis has the # of misspecs aka the panels on previous
- and the colors are the amt of relative error for the last 10 years SSB
- the labels tell you what is misspecified in the model
- the more yellow, the better
- what we see here is that going from 5 to 4 misspecs has an outsize pos effect on rel err,
- which is interesting because in every single case that was where we fixed spatial structure
- improvements continue after that, but the biggest decline happens at that initial step
- this result is especially striking, because...
---
background-image: url("SSB_Terminal_Tile_E2.png")
background-position: top
background-size: contain
<Br><Br><br><br><Br><Br><Br><Br><br>
<Br><Br><br><br><Br><Br><br><br><br>
```{r echo = FALSE, fig.align = 'left', out.height="10%", out.width="25%",fig.retina = 2}
knitr::include_graphics("legend2.png")
```
???


- the exact same was found for exp 2, where spatial structure wasn't corrected until after all else
- this plot is setup the same way, with the labeled letters tellin you what's wrong with this model
- as we expect, we do see the model getting more oand more correct with fewer misspecs, but we never get into the "yellow zone" until space is cleared up.

- Another interesting thing we can see from this plot is what besides space seems to have a possitive effect
- on the left side of this image we are looking at models with only one or two correctiongs
- say we were only interested in correcting one thing, moving from 5 to 4 misspecs,
- we see these clusters of lighter areas that seem to have done better
- what they have in common is these were EMs which corrected L (asymp length) or X (selex)
---
background-image: url("ID_boxplot_E2.png")
background-position: center
background-size: contain
```{r echo = FALSE, fig.align = 'left', out.height="25%", out.width="25%",fig.retina = 2}
knitr::include_graphics("legend4.png")
```
???
- can show these results from the previousin the format i introduced at the beginning, 
- where we see the spread of absolute changes in relErr accodring to identity.
- here i have two panels now, the right hand is biomass which is the same as the plot we saw before
- and right is recruitment
- What is cool is that for this experiment, space wasn't corrected till the very end but STILL had the largest impact on relative error 
- NOTE TO SELF: the variation comes from the fact that we're compiling any poss location where X,L etc were corrected, hence the spread. interesting that the trend persists even though there were equivalent # of models which were run with L last etc

---
background-image: url("Rec_error_panel_E1_dark.png")
background-position: center
background-size: contain
???
- one other interesting result to share
- here is E1 again but for recruitment
- as I'd expect, mag/var in rel err goes way up as we increase number of misspecs
- some of this is due to div small numbers, but still
- weirdest thing was this strange banding, which suggests 
- that there are clusters of EMs which are mostly pos or neg biased
- so i took this plot, and re-colored it...
---
background-image: url("Rec_error_M_E1_dark.png")
background-position: center
background-size: contain
???
- to illustrate what value of natural mortality was used within the EMs
- here, blue means the EM was misspecified using a natM above than the OM, and gold was below
- we only start to see white lines up to number 3, because models with 4 or 5 misspecs for E1 only have space misspeced
- the outcome here is that only those models with M and SPACE right are hanging out around the zero line,
- and we can effectively predict the direction of bias in your recruit estimates depending on whether natM is low or hi
---
background-image: url("https://opuszine.us/_assets/entries/cassini-retirement.jpg")
background-size: contain
## .inverse[ Making sense of a massive study I]

???
- one takeaway is my precience @ think tank last year in used the casini sp mission in intro
- because actually at the time of thinktank weren't considering space
- because too hard to implement (but alas grad school)
- proved fitting i picked space example, because..
---
background-image: url("https://opuszine.us/_assets/entries/cassini-retirement.jpg")
background-size: cover
## .inverse[ Making sense of a massive study I]

--

.pull-left[
.large[
.inverse[
+ Space matters most for both biomass & recruitment
]]]

.pull-right[
![](rocketfish.jpg)]

???
- spatial structure ended up having the most outsize influence on model estimates
- and incredibly this held true regardless of whether or not every other imporant thing was right
- we saw from the colored tileplots from both experiments
- whether space was corrected first or last, you got the most bang for your buck by correctly specifying

---
background-image: url("https://opuszine.us/_assets/entries/cassini-retirement.jpg")
background-size: cover
## .inverse[ Making sense of a massive study I]

.pull-left[
.large[
.inverse[
+ Space matters most for both biomass & recruitment
+ For biomass, growth & selectivity are early winners
+ For recruitment, Natural mortality induces systematic bias 
]
]
]

.pull-right[
![](rocketfish.jpg)]

???

- there were also interesting sub-findings of this work
- which was that even if you started with correct spatial structure,
- having misspec M will guarantee that your model outputs are biased,
- and we can even predict the direction depending whether M is hi or low.

- finally exp 2 revaled that while space is most important, the quickest reduction in
- relerr for biomass otherwise came from correcting growth and selex early on.
- so some of your prioritization among these things would depend on if you were more interested in SSB and recruitment

---

background-image: url("https://opuszine.us/_assets/entries/cassini-retirement.jpg")
background-size: contain

## .inverse[ Making sense of a complex study II]

.pull-left[
.inverse[
.large[
+ These studies are...very involved 
]
]
]

.pull-right[
![](rocketfish.jpg)]

???
- now for some more big picture takeaways
- the analysis i've done here is pretty straightforward, just summing and averaging relErr
- i feel that is the easiest to digest for broad audience
- what we've done here is produce a huge and detailed dataset
- i'll be the first to say that as i worked up results i sense that this is hungry for optimization
algo, 
- so i'd be realy happy to collab on subsequent publications with folks with experience in those areas 
- because i think there are hidden patterns that we can't do justice for


---
background-image: url("https://opuszine.us/_assets/entries/cassini-retirement.jpg")
background-size: contain
## .inverse[ Making sense of a massive study II]

.pull-left[
.inverse[
.large[
+ These studies are...very involved 
+ Basic changes = enormous consequences on model estimates
+ Empirical research is worth a lot!
]
] 
]
.pull-right[
![](rocketfish.jpg)]
???
- directed towards the folks working on the research that directly informs 
our params.
- if you are someone cutting up fish heads to nail asymp L
- or perhaps doing genetic work to determine stock structure in a managed area,
- my hope is you can point to this work to re-emphasize the direct, 
- specific contribution your findings will have on the accuracy of our management science.

---
# .inverse[extra material]
---

